# STP 순서 정하기
**꼭 외워야 함**
  - 1.누가 더 작은 ROOT BID 를 가지는가?
  - 2.루트 브리지까지의 Path Costs 값은 누가 더 작은가?
  - 3.누구의 BID (Sensor Bid)가 더 낮은가?
  - 4.누구의 Port ID 가 더 낮은가?

브리지는 스패닝 트리 정보를 자기들끼리 주고 받기 위해서 특수한 프레임 을 사용하는데,이를 "BPDU(Bridge Protocol Data Unit)" 이라고 한다.

**BPDU 에는 루트브리지의 BID (Root BID),루트 브리지 까지 가는 경로값인 Root Path Cost, 보내는 브리지의 BID 인 Sender BID, 그리고 어떤 포트에서 보냈는지 알수있는 Port ID 등 정보가 실려있다.**

스위치 (브릿지) 가 부팅을 하게 되면 BPDU 를 매 2초마다 내보내면서 서로의 스패닝 트리 정보를 주고 받게 됩니다. 즉 브리지는 이 BPDU 를 주고 받으면서 누가 루트 브리지고 어떤 포트가 루트포트가 될지 정하게 된다.

- 루트 브리지 선출
  - 각 스위치에서 부팅시에너느 BPDU 의 루트 BID 와 SENDER BID 를 자신으로 하고 프레임을 전송한다.
  - 다른 곳 에서 날라온 BPDU 와 비교하여 루트 브리지를 선출한다.

- 데지그네이티드 포트 선출.
  - 세그먼트 상에서 Root Path Cost 를 서로 비교해서 더 작은 Root Path Cost 를 가진 포트가 데지그네이티드 포트 로 선출된다.
  - 루트 브리지의 모든 포트는 데지그네이티드 포트로 선정된다.
  - 만약 Path Cost 가 같으면 <u>루트 포트나 데지그네이티드 포트 선정 단계를 거쳐거 선정하게된다.</u>
  - ND (Non Deginated port) : 루트 포트나 데지그네이티드 포트가 아닌 나머지 포트
  
- 스패닝 트리 프로토콜 다섯가지 상태 변화 (포트)
  - **Disabled** : 포트 고장및 관리자가 꺼놓은 상태
  - **Blocking** : 스위치를 맨처음 켜거나 Disabled 되있는 포트를 관리자가 다시 살렸을때 그 포트는 Blocking 상태가 된다.(BPDU 교환)
  - **Listening** : Blocking 상태에 있던 스위치 포트가 루트 포트나 데지그네이티드 포트로 선정되면 바로 Listening 상태가 된다. 언제든지 Bloking 상태가 될수 있는 단계이다.
  - **Learning** : Linstening 상태에 있던 스위치 포트가 포워딩 딜레이 디폴트 시간인 15초 동안 그 상태를 유지하면 Learning 상태가 되고 MAC 주소를 배운다.
  - **Forwarding** : 스위치 포트가 Learning 상태에서도 15초를 유지하러면 비로소 데이터 프레임을 주고받는 Fowarding 상태가 된다.

- 스패닝 트리 재편성 관련 용어 정리 
  - Hello Time  : 루트 브리지가 논 루트 브리지 에게 헬로 BPDU 를 보내는 시간 디폴트 2시간.