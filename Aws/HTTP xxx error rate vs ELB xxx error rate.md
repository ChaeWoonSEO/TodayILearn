ALB를 사용하다보면 많은 트러블 슈팅 상황에 직면하는 상황이 발생한다.
개인적으로 문제상황을 확인 할때 제일 먼저 해당 리소스의 CloudWatch 지표들을 확인하는 편이다. 

한번은 ALB에 접근 시 HTTP 502 bad gateway 상태코드가 반환되어 ALB를 확인하고 있었다. Ec2 인스턴스 측으로 트래픽 을 보내도록 대상그룹이 구성되어있었으며, ALB 측 문제인지, Ec2 문제인지 정확히 파악하기 위해선 직접 모든 구성들은 확인해보며 문제를 파악하는 수 밖에 없었다.

위와 같이 번거로운 작업을 하기 전 어느정도 틀을 잡고 자세히 문제에 대해서 파고들싶어서 여러 지표들을 확인 해본 결과 HTTP xxx error rate , ELB xxx error rate 두 지표를 알게 되었다.(여기서 말한 xxx 에서는 HTTP Status Code 가 들어간다 ex. 502, 404)

위 지표들을 정확히 모른채로 처음 확인시 두 지표 모두 특정 상태코드가 반환될 시 누적값으로 표현될 것이라고 생각했지만 예상과는 다르게 두 지표가 서로 다른것을 볼 수 있었다. 예를들면, HTTP 4xx 지표에서는 관련 에러가 발생한 흔적을 찾을 수 있었지만, ELB 4xx 지표에서는 에러가 발생한 것이 보이지 않았기 때문이다. 

그렇기 때문에 관련해서 AWS 공식 docs 를 확인해 보았다. 
 

AWS docs 에서는 각각 두 지표를 다른 이름으로 표현 해놓았는데, 위 ALB 콘솔에서는 HTTP 4xx error 이렇게 표현되어있지만, CloudWatch 에서 수집되는 메트릭의 이름은 `HTTPCode_Target_4xx_Count` 로 약간 다른것을 확인 해 볼 수 있었다. 